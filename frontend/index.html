<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Planning Poker</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Planning Poker</h1>

  <!-- Session Management -->
  <section id="session-section">
    <h2>Create a New Session</h2>
    <input type="text" id="developer-name" placeholder="Your name" />
    <button id="create-session-btn">Create Session</button>
    <p id="session-result"></p>
  </section>

  <section id="join-session-section">
    <h2>Join a Session</h2>
    <input type="text" id="join-name" placeholder="Your name" />
    <input type="text" id="join-session-id" placeholder="Session ID" />
    <button id="join-session-btn">Join Session</button>
    <p id="join-result"></p>
  </section>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    // Handle the creation of a session
    document.getElementById("create-session-btn").addEventListener("click", function() {
      const developerName = document.getElementById("developer-name").value;
      if (!developerName) {
        alert("Please enter your name!");
        return;
      }

      // Make a POST request to create a new session
      fetch('/session', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ name: developerName }),
      })
      .then(response => response.json())
      .then(data => {
        // Get the session ID from the response
        const sessionId = data.sessionId;
        // Redirect to session.html with the session ID
        window.location.href = `session.html?id=${sessionId}`;
      })
      .catch(error => {
        document.getElementById("session-result").innerText = "Error creating session!";
        console.error("Error:", error);
      });
    });

    // Handle joining a session
    document.getElementById("join-session-btn").addEventListener("click", function() {
      const developerName = document.getElementById("join-name").value;
      const sessionId = document.getElementById("join-session-id").value;

      if (!developerName || !sessionId) {
        alert("Please enter both your name and a session ID!");
        return;
      }

      // Make a GET request to check if the session exists
      fetch(`/session/${sessionId}`)
        .then(response => {
          if (response.ok) {
            // Redirect to session.html with the session ID
            window.location.href = `session.html?id=${sessionId}`;
          } else {
            document.getElementById("join-result").innerText = "Session not found!";
          }
        })
        .catch(error => {
          document.getElementById("join-result").innerText = "Error joining session!";
          console.error("Error:", error);
        });
    });
  </script>
</body>
</html>
